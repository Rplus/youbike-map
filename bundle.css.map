{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "../App.svelte",
    "../Comment.svelte"
  ],
  "sourcesContent": [
    "<script>\n  import Comment from './Comment.svelte';\n\n\tlet name = 'world';\n  let range = 1000;\n  let location = null;\n  let points = [];\n  $: recentPoints = getRecentPoints(points, range, location);\n  const KEY = 'AIzaSyCjDnDGv67nvhzBsLRYAwTbiF1HrZBQDUM';\n\n  $: currentPosMarker = location ? `&markers=${location.lat},${location.lng}` : undefined;\n\n  const locateOption = {\n    enableHighAccuracy: true,\n    timeout: 5000,\n    maximumAge: 0\n  };\n\n  function getLocation () {\n    return new Promise((resolve, reject) => {\n      navigator.geolocation.getCurrentPosition(resolve, reject, locateOption);\n    });\n  };\n\n  async function setLocate() {\n    let position = await getLocation();\n    location = {\n      lat: position.coords.latitude,\n      lng: position.coords.longitude,\n      acc: position.coords.accuracy,\n    };\n    console.log('setLocate', location);\n  }\n\n  async function fetchData() {\n    setLocate();\n\n    console.log('fetchData');\n    const res = await fetch('https://tcgbusfs.blob.core.windows.net/blobyoubike/YouBikeTP.json').then(d => d.json())\n    console.log('fetchData done', res);\n    points = Object.values(res.retVal);\n  };\n\n  function getRecentPoints(points, range, location) {\n    console.log('getRecentPoints');\n    points = points.map(p => {\n      p.img = getImgSrc(p);\n      return p;\n    });\n\n    if (location) {\n      points = points.filter(p => {\n        const distance = GreatCircleDistance([\n          location.lng,\n          location.lat,\n          p.lng,\n          p.lat\n        ]);\n        p.distance = distance.toFixed();\n        return distance < range;\n      })\n    }\n\n    return points.sort((a, b) => a.distance - b.distance);\n  }\n\n  // https://en.wikipedia.org/wiki/Great-circle_distance\n  // https://gist.github.com/thesadabc/f84adeea5644149539dae968ccdb3f2c\n  function GreatCircleDistance(points) {\n    let [lng1, lat1, lng2, lat2] = points;\n    if (!lng1 || !lat1 || !lng2 || !lat2) return null;\n    [lng1, lat1, lng2, lat2] = points.map(n => n * Math.PI / 180)\n    const R = 6371000; // average earth radius(m)\n    const C = Math.sin(lat1) * Math.sin(lat2) +\n      Math.cos(lng1 - lng2) * Math.cos(lat1) * Math.cos(lat2);\n    return R * Math.acos(C);\n  }\n\n  function getImgSrc(\n    target,\n    size = 300,\n  ) {\n    let p0 = target;\n    let p1;\n\n    if (location) {\n      p0 = location;\n      p1 = target;\n    }\n\n    return (\n      'https://maps.googleapis.com/maps/api/staticmap'\n      + `?size=${size}x${size}`\n      + `&center=${p0.lat},${p0.lng}`\n      + `&markers=size:mid|${p0.lat},${p0.lng}`\n      + (p1 ? `&markers=color:yellow|label:T|${p1.lat},${p1.lng}` : '')\n      + `&key=${KEY}`\n    );\n  }\n\n  fetchData();\n</script>\n\n\n\n<!--  -->\n\n\n\n<nav class=\"ctrl\">\n  <button id=\"locate\" on:click={setLocate}>定位</button>\n  <button id=\"refetch\" on:click={fetchData}>更新</button>\n  <div>\n    <span>距: {range} m</span>\n    <br>\n    <input type=\"range\" id=\"range\" bind:value={range} max=\"5000\" min=\"10\" />\n  </div>\n</nav>\n\n<ol class=\"list\">\n  {#each recentPoints as point (point.sno)}\n    <li class=\"item\" value={point.sno}>\n\n      <div class=\"d-f jc-sb ai-c\">\n        <div>\n          <div>{point.sna}</div>\n        </div>\n\n        <div class=\"numbers d-f ai-c fs-0\">\n          {point.tot}\n          <hr>\n          <div>\n            <div class=\"bike\">車 {point.sbi}</div>\n            <div class=\"empty\">空 {point.bemp}</div>\n          </div>\n        </div>\n      </div>\n\n      <details class=\"details\">\n        <summary>\n          {point.distance} m\n        </summary>\n        <a href=\"http://maps.google.com?q={point.lat},{point.lng}\" target=\"_blank\" title=\"google map link\">{point.lat}, {point.lng}\n        </a>\n        <a class=\"img\" style=\"--url: url({point.img})\" href={point.img} target=\"_blank\">{point.img}</a>\n      </details>\n    </li>\n  {/each}\n</ol>\n\n\n<footer>\n  <Comment />\n\n  <ul class=\"info\">\n    <li>\n      GitHub: <a href=\"https://github.com/rplus/youbike-map\">Rplus / Youbike-Map</a>\n    </li>\n    <li>\n      Relesed with: <a href=\"https://github.com/Rplus/youbike-map/blob/master/LICENSE\">MIT license</a>\n    </li>\n    <li>\n      資料來源:\n      <br>\n      <a href=\"https://taipeicity.github.io/traffic_realtime/\">臺北市政府 交通即時資料 開放資料專區</a>\n    </li>\n  </ul>\n</footer>\n\n\n\n<!--  -->\n\n\n\n<style>\n  .ctrl {\n    position: fixed;\n    top: 0;\n    z-index: 1;\n    height: 3em;\n    display: flex;\n    align-items: center;\n    justify-content: space-evenly;\n    width: 400px;\n    max-width: 100%;\n    background-color: #ffe;\n  }\n\n  .list {\n    padding: 3em .5em;\n  }\n\n  .item {\n    margin-bottom: 1em;\n    display: block;\n    padding-bottom: 1em;\n    border-bottom: 1px dotted #ccc;\n  }\n\n  .bike { padding-bottom: .25em; }\n  .empty { color: #999; }\n\n  .details {\n    margin-top: 1em;\n    margin-left: 2em;\n    max-width: 100%;\n  }\n\n  .details summary {\n    opacity: .4;\n  }\n\n  .img {\n    display: block;\n    width: 300px;\n    height: 300px;\n    max-width: 100%;\n    word-break: break-all;\n    color: transparent;\n  }\n\n  :global(details[open]) .img {\n    background-color: #cfc;\n    background-image: var(--url);\n  }\n\n  .sr-only {\n    position: absolute !important;\n    width: 1px !important;\n    height: 1px !important;\n    padding: 0 !important;\n    margin: -1px !important;\n    overflow: hidden !important;\n    clip: rect(0, 0, 0, 0) !important;\n    white-space: nowrap !important;\n    border: 0 !important;\n  }\n\n  .info {\n    font-family: monospace;\n  }\n\n  .d-f {\n    display: flex;\n  }\n\n  .ai-c { align-items: center; }\n  .jc-sb { justify-content: space-between; }\n  .fs-0 { flex-shrink: 0; }\n\n  .d-f hr {\n    align-self: stretch;\n    margin: 0 .5em;\n  }\n\n  :global(body) {\n    max-width: 400px;\n    margin: 0 auto;\n    overflow-y: scroll;\n  }\n\n  :global(*) {\n    box-sizing: border-box;\n  }\n</style>\n",
    "<script>\n  let open;\n\n  function initDisqus(e) {\n    if (!open) { return; }\n    console.log('initDisqus');\n\n    if (window.DISQUS) {\n      window.DISQUS.reset({\n        reload: true,\n      });\n      return;\n    }\n    (function() {\n      var d = document, s = d.createElement('script');\n      s.src = 'https://rplus-youbike-map.disqus.com/embed.js';\n      s.setAttribute('data-timestamp', +new Date());\n      (d.head || d.body).appendChild(s);\n    })();\n  }\n\n  function onToggle(e) {\n    console.log(1111111111, e);\n    open = e.target.open;\n    initDisqus();\n  }\n</script>\n\n<details on:toggle={onToggle}>\n  <summary>開啟留言</summary>\n  <div>\n    <div id=\"disqus_thread\"></div>\n  </div>\n</details>\n\n\n<style>\n  details {\n    padding: 1em;\n  }\n</style>\n"
  ],
  "names": [],
  "mappings": "AAgLE,KAAK,8BAAC,CAAC,AACL,QAAQ,CAAE,KAAK,CACf,GAAG,CAAE,CAAC,CACN,OAAO,CAAE,CAAC,CACV,MAAM,CAAE,GAAG,CACX,OAAO,CAAE,IAAI,CACb,WAAW,CAAE,MAAM,CACnB,eAAe,CAAE,YAAY,CAC7B,KAAK,CAAE,KAAK,CACZ,SAAS,CAAE,IAAI,CACf,gBAAgB,CAAE,IAAI,AACxB,CAAC,AAED,KAAK,8BAAC,CAAC,AACL,OAAO,CAAE,GAAG,CAAC,IAAI,AACnB,CAAC,AAED,KAAK,8BAAC,CAAC,AACL,aAAa,CAAE,GAAG,CAClB,OAAO,CAAE,KAAK,CACd,cAAc,CAAE,GAAG,CACnB,aAAa,CAAE,GAAG,CAAC,MAAM,CAAC,IAAI,AAChC,CAAC,AAED,KAAK,8BAAC,CAAC,AAAC,cAAc,CAAE,KAAK,AAAE,CAAC,AAChC,MAAM,8BAAC,CAAC,AAAC,KAAK,CAAE,IAAI,AAAE,CAAC,AAEvB,QAAQ,8BAAC,CAAC,AACR,UAAU,CAAE,GAAG,CACf,WAAW,CAAE,GAAG,CAChB,SAAS,CAAE,IAAI,AACjB,CAAC,AAED,uBAAQ,CAAC,OAAO,eAAC,CAAC,AAChB,OAAO,CAAE,EAAE,AACb,CAAC,AAED,IAAI,8BAAC,CAAC,AACJ,OAAO,CAAE,KAAK,CACd,KAAK,CAAE,KAAK,CACZ,MAAM,CAAE,KAAK,CACb,SAAS,CAAE,IAAI,CACf,UAAU,CAAE,SAAS,CACrB,KAAK,CAAE,WAAW,AACpB,CAAC,AAEO,aAAa,AAAC,CAAC,IAAI,8BAAC,CAAC,AAC3B,gBAAgB,CAAE,IAAI,CACtB,gBAAgB,CAAE,IAAI,KAAK,CAAC,AAC9B,CAAC,AAcD,KAAK,8BAAC,CAAC,AACL,WAAW,CAAE,SAAS,AACxB,CAAC,AAED,IAAI,8BAAC,CAAC,AACJ,OAAO,CAAE,IAAI,AACf,CAAC,AAED,KAAK,8BAAC,CAAC,AAAC,WAAW,CAAE,MAAM,AAAE,CAAC,AAC9B,MAAM,8BAAC,CAAC,AAAC,eAAe,CAAE,aAAa,AAAE,CAAC,AAC1C,KAAK,8BAAC,CAAC,AAAC,WAAW,CAAE,CAAC,AAAE,CAAC,AAEzB,mBAAI,CAAC,EAAE,eAAC,CAAC,AACP,UAAU,CAAE,OAAO,CACnB,MAAM,CAAE,CAAC,CAAC,IAAI,AAChB,CAAC,AAEO,IAAI,AAAE,CAAC,AACb,SAAS,CAAE,KAAK,CAChB,MAAM,CAAE,CAAC,CAAC,IAAI,CACd,UAAU,CAAE,MAAM,AACpB,CAAC,AAEO,CAAC,AAAE,CAAC,AACV,UAAU,CAAE,UAAU,AACxB,CAAC;ACnOD,OAAO,cAAC,CAAC,AACP,OAAO,CAAE,GAAG,AACd,CAAC"
}