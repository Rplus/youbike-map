{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "../App.svelte",
    "../Comment.svelte"
  ],
  "sourcesContent": [
    "<script>\n  import Comment from './Comment.svelte';\n\n  let range = 1000;\n  let location = null;\n  let points = [];\n  $: recentPoints = getRecentPoints(points, range, location);\n  const KEY = 'AIzaSyCjDnDGv67nvhzBsLRYAwTbiF1HrZBQDUM';\n\n  $: currentPosMarker = location ? `&markers=${location.lat},${location.lng}` : undefined;\n  $: errMsg = '';\n  $: updateTime = '';\n\n  const locateOption = {\n    enableHighAccuracy: true,\n    timeout: 5000,\n    maximumAge: 0\n  };\n\n  function getLocation () {\n    return new Promise((resolve, reject) => {\n      navigator.geolocation.getCurrentPosition(resolve, reject, locateOption);\n    });\n  };\n\n  async function setLocate() {\n    let position = await getLocation();\n    location = {\n      lat: position.coords.latitude,\n      lng: position.coords.longitude,\n      acc: position.coords.accuracy,\n    };\n    console.log('setLocate', location);\n  }\n\n  async function fetchData() {\n    setLocate();\n\n    console.log('fetchData');\n    try {\n      const res = await fetch('https://tcgbusfs.blob.core.windows.net/blobyoubike/YouBikeTP.json')//.then(d => d.json())\n      const data = await res.json();\n      points = Object.values(data.retVal);\n      console.log('fetchData done', data);\n    }\n    catch (err) {\n      errMsg = err;\n      console.error(123, err);\n    }\n    updateTime = new Intl.DateTimeFormat('zh-TW', { timeStyle: 'medium', hour12: false }).format(new Date());\n  };\n\n  function getRecentPoints(points, range, location) {\n    console.log('getRecentPoints');\n    points = points.map(p => {\n      p.img = getImgSrc(p);\n      return p;\n    });\n\n    if (location) {\n      points = points.filter(p => {\n        const distance = GreatCircleDistance([\n          location.lng,\n          location.lat,\n          p.lng,\n          p.lat\n        ]);\n        p.distance = distance.toFixed();\n        let dx = p.lng - location.lng;\n        let dy = p.lat - location.lat;\n        p._d = p.distance / range;\n        p._a = 180 * (Math.atan2( dy, dx ) / Math.PI);\n        return distance < range;\n      })\n    }\n\n    return points.sort((a, b) => a.distance - b.distance);\n  }\n\n  // https://en.wikipedia.org/wiki/Great-circle_distance\n  // https://gist.github.com/thesadabc/f84adeea5644149539dae968ccdb3f2c\n  function GreatCircleDistance(points) {\n    let [lng1, lat1, lng2, lat2] = points;\n    if (!lng1 || !lat1 || !lng2 || !lat2) return null;\n    [lng1, lat1, lng2, lat2] = points.map(n => n * Math.PI / 180)\n    const R = 6371000; // average earth radius(m)\n    const C = Math.sin(lat1) * Math.sin(lat2) +\n      Math.cos(lng1 - lng2) * Math.cos(lat1) * Math.cos(lat2);\n    return R * Math.acos(C);\n  }\n\n  function getImgSrc(target, size = 300) {\n    let p0 = target;\n    let p1;\n\n    if (location) {\n      p0 = location;\n      p1 = target;\n    }\n\n    return (\n      'https://maps.googleapis.com/maps/api/staticmap'\n      + `?size=${size}x${size}`\n      + `&center=${p0.lat},${p0.lng}`\n      + `&markers=size:mid|${p0.lat},${p0.lng}`\n      + (p1 ? `&markers=color:yellow|label:T|${p1.lat},${p1.lng}` : '')\n      + `&key=${KEY}`\n    );\n  }\n\n  fetchData();\n</script>\n\n\n\n<!--  -->\n\n\n\n<nav class=\"ctrl\">\n  <button id=\"locate\" on:click={setLocate}>定位</button>\n  <button id=\"refetch\" on:click={fetchData} data-updatetime={updateTime}>更新</button>\n  <div>\n    <span>距: {range} m</span>\n    <br>\n    <input type=\"range\" id=\"range\" bind:value={range} max=\"5000\" min=\"10\" step=\"50\" />\n  </div>\n</nav>\n\n\n<div class=\"workspace\">\n\n  <div class=\"error-message\">\n    {errMsg}\n  </div>\n\n  {#if location}\n    <div class=\"map\">\n      {#each recentPoints.slice(0, 5) as point (point.sno)}\n        <div class=\"map-point\"\n          data-name={point.sna}\n          data-bike={point.sbi}\n          style=\"--d: {point._d}; --a: {point._a}; \"\n        />\n      {/each}\n    </div>\n  {/if}\n\n  <ol class=\"list\">\n    {#each recentPoints as point (point.sno)}\n      <li class=\"item\" value={point.sno}>\n\n        <div class=\"d-f jc-sb ai-c\">\n          <div>\n            <div>{point.sna}</div>\n          </div>\n\n          <div class=\"numbers d-f ai-c fs-0\">\n            <span class=\"sum\">{point.tot}</span>\n            <hr>\n            <div>\n              <div class=\"bike\">車 {point.sbi}</div>\n              <div class=\"empty\">空 {point.bemp}</div>\n            </div>\n          </div>\n        </div>\n\n        <details class=\"details\">\n          <summary class=\"summary\">\n            {point.distance} m\n          </summary>\n          <a href=\"http://maps.google.com?q={point.lat},{point.lng}\" target=\"_blank\" title=\"google map link\">{point.lat}, {point.lng}\n          </a>\n          <a class=\"img\" style=\"--url: url({point.img})\" href={point.img} target=\"_blank\">_</a>\n        </details>\n      </li>\n    {/each}\n  </ol>\n</div>\n\n\n<footer class=\"footer d-f\">\n  <header>\n    <h1>YouBike Map</h1>\n  </header>\n  <Comment />\n\n  <ul class=\"info\">\n    <li>\n      GitHub: <a href=\"https://github.com/rplus/youbike-map\">Rplus / Youbike-Map</a>\n    </li>\n    <li>\n      Relesed with: <a href=\"https://github.com/Rplus/youbike-map/blob/master/LICENSE\">MIT license</a>\n    </li>\n    <li>\n      資料來源:\n      <br>\n      <a href=\"https://taipeicity.github.io/traffic_realtime/\">臺北市政府 交通即時資料 開放資料專區</a>\n    </li>\n  </ul>\n</footer>\n\n\n\n<!--  -->\n\n\n\n<style>\n  .ctrl {\n    position: fixed;\n    top: 0;\n    z-index: 1;\n    height: 3em;\n    display: flex;\n    align-items: center;\n    justify-content: space-evenly;\n    width: 400px;\n    max-width: 100%;\n    background-color: #ffe;\n  }\n\n  #refetch {\n    position: relative;\n  }\n  #refetch::before {\n    content: attr(data-updatetime);\n    position: absolute;\n    top: 100%;\n    left: -.5em;\n    font-family: monospace;\n    color: #aaa;\n  }\n\n  .workspace {\n    padding-top: 3em;\n  }\n\n  .error-message {\n    font-family: monospace;\n    color: #900;\n  }\n\n  .map {\n    margin-top: 1em;\n    position: relative;\n    padding-bottom: calc(100% - 2em);\n    text-align: right;\n    overflow: hidden;\n    margin-left: 1em;\n    margin-right: 1em;\n    box-shadow: inset 0 0 5px 2px #0003;\n    background-color: #0991;\n  }\n\n  .map-point {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: calc(70% * var(--d));\n    height: 0;\n    box-shadow: 0 0 0 1px #0003;\n    background-color: #f00;\n    transform-origin: 0% 50%;\n    transform: rotate(calc(var(--a) * -1deg));\n  }\n\n  .map-point:hover {\n    --o: .4;\n  }\n\n  .map-point::after {\n    content: attr(data-name);\n    position: absolute;\n    top: 0;\n    left: 100%;\n    width: max-content;\n    transform-origin: 50% 50%;\n    transform: translate(-50%, 50%) rotate(calc(var(--a) * 1deg));\n    color: rgba(0, 0, 0, var(--o, 0));\n    pointer-events: none;\n    font-size: small;\n    white-space: nowrap;\n  }\n\n  .map-point::before {\n    content: attr(data-bike);\n    position: relative;\n    display: inline-flex;\n    width: 1.75em;\n    height: 1.75em;\n    align-items: center;\n    justify-content: center;\n    transform: translate(100%, -50%) rotate(calc(var(--a) * 1deg));\n    border-radius: 1em;\n    box-shadow: 0 0 0 1px #0002;\n  }\n\n  .list {\n    padding: 0 .5em;\n  }\n\n  .item {\n    margin-bottom: 1em;\n    display: block;\n    padding-bottom: 1em;\n    border-bottom: 1px dotted #ccc;\n  }\n\n  .sum { color: #999; }\n  .bike { padding-bottom: .25em; }\n  .empty { color: #999; }\n\n  .details {\n    margin-top: 1em;\n    margin-left: 2em;\n    max-width: 100%;\n  }\n\n  .summary {\n    opacity: .4;\n  }\n\n  .img {\n    display: block;\n    width: 300px;\n    height: 300px;\n    max-width: 100%;\n    word-break: break-all;\n    color: transparent;\n  }\n\n  :global(details[open]) .img {\n    background-color: #cfc;\n    background-image: var(--url);\n  }\n\n  .info {\n    align-self: center;\n    font-family: monospace;\n  }\n\n  .footer {\n    position: relative;\n    z-index: 2;\n    min-height: 100vh;\n    background-color: #eef;\n    flex-direction: column;\n  }\n\n  header {\n    text-align: center;\n    border-bottom: 1px dashed #aaa;\n  }\n\n  .d-f {\n    display: flex;\n  }\n\n  .ai-c { align-items: center; }\n  .jc-sb { justify-content: space-between; }\n  .fs-0 { flex-shrink: 0; }\n\n  .d-f hr {\n    align-self: stretch;\n    margin: 0 .5em;\n  }\n\n  :global(body) {\n    max-width: 400px;\n    margin: 0 auto;\n    overflow-y: scroll;\n  }\n\n  :global(*) {\n    box-sizing: border-box;\n  }\n</style>\n",
    "<script>\n  let open;\n\n  function initDisqus(e) {\n    if (!open) { return; }\n    console.log('initDisqus');\n\n    if (window.DISQUS) {\n      window.DISQUS.reset({\n        reload: true,\n      });\n      return;\n    }\n    (function() {\n      var d = document, s = d.createElement('script');\n      s.src = 'https://rplus-youbike-map.disqus.com/embed.js';\n      s.setAttribute('data-timestamp', +new Date());\n      (d.head || d.body).appendChild(s);\n    })();\n  }\n\n  function onToggle(e) {\n    console.log(1111111111, e);\n    open = e.target.open;\n    initDisqus();\n  }\n</script>\n\n<details on:toggle={onToggle}>\n  <summary>開啟留言</summary>\n  <div>\n    <div id=\"disqus_thread\"></div>\n  </div>\n</details>\n\n\n<style>\n  details {\n    padding: 1em;\n    margin-top: auto;\n    margin-bottom: auto;\n  }\n</style>\n"
  ],
  "names": [],
  "mappings": "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"
}