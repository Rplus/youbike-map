var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(t,e){t.appendChild(e)}function l(t,e,n){t.insertBefore(e,n||null)}function i(t){t.parentNode.removeChild(t)}function c(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function f(){return u(" ")}function d(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function p(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function m(t,e){e=""+e,t.data!==e&&(t.data=e)}function g(t,e){(null!=e||t.value)&&(t.value=e)}function h(t,e,n,o){t.style.setProperty(e,n,o?"important":"")}let b;function $(t){b=t}const v=[],y=[],k=[],w=[],x=Promise.resolve();let _=!1;function M(t){k.push(t)}let E=!1;const S=new Set;function A(){if(!E){E=!0;do{for(let t=0;t<v.length;t+=1){const e=v[t];$(e),D(e.$$)}for(v.length=0;y.length;)y.pop()();for(let t=0;t<k.length;t+=1){const e=k[t];S.has(e)||(S.add(e),e())}k.length=0}while(v.length);for(;w.length;)w.pop()();_=!1,E=!1,S.clear()}}function D(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(M)}}const j=new Set;function C(t,e){t&&t.i&&(j.delete(t),t.i(e))}function L(t,e){t.d(1),e.delete(t.key)}function P(t,n,s){const{fragment:a,on_mount:l,on_destroy:i,after_update:c}=t.$$;a&&a.m(n,s),M(()=>{const n=l.map(e).filter(r);i?i.push(...n):o(n),t.$$.on_mount=[]}),c.forEach(M)}function T(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function q(t,e){-1===t.$$.dirty[0]&&(v.push(t),_||(_=!0,x.then(A)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function I(e,r,s,a,l,c,u=[-1]){const f=b;$(e);const d=r.props||{},p=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:l,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(f?f.$$.context:[]),callbacks:n(),dirty:u};let m=!1;if(p.ctx=s?s(e,d,(t,n,...o)=>{const r=o.length?o[0]:n;return p.ctx&&l(p.ctx[t],p.ctx[t]=r)&&(p.bound[t]&&p.bound[t](r),m&&q(e,t)),n}):[],p.update(),m=!0,o(p.before_update),p.fragment=!!a&&a(p.ctx),r.target){if(r.hydrate){const t=function(t){return Array.from(t.childNodes)}(r.target);p.fragment&&p.fragment.l(t),t.forEach(i)}else p.fragment&&p.fragment.c();r.intro&&C(e.$$.fragment),P(e,r.target,r.anchor),A()}$(f)}class H{$destroy(){T(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function R(e){let n,o;return{c(){n=c("details"),n.innerHTML='<summary>開啟留言</summary> \n  <div><div id="disqus_thread"></div></div>',p(n,"class","svelte-7s7b5e")},m(t,r,s){l(t,n,r),s&&o(),o=d(n,"toggle",e[0])},p:t,i:t,o:t,d(t){t&&i(n),o()}}}function z(t){let e;return[function(t){var n,o;console.log(1111111111,t),e=t.target.open,e&&(console.log("initDisqus"),window.DISQUS?window.DISQUS.reset({reload:!0}):(n=document,(o=n.createElement("script")).src="https://rplus-youbike-map.disqus.com/embed.js",o.setAttribute("data-timestamp",+new Date),(n.head||n.body).appendChild(o)))}]}class B extends H{constructor(t){super(),I(this,t,z,R,s,{})}}function N(t,e,n){const o=t.slice();return o[12]=e[n],o}function O(t,e){let n,o,r,s,d,g,b,$,v,y,k,w,x,_,M,E,S,A,D,j,C,L,P,T,q,I,H,R,z,B,N,O,Q,U,Y,F,G=e[12].sna+"",V=e[12].tot+"",Z=e[12].sbi+"",J=e[12].bemp+"",K=e[12].distance+"",W=e[12].lat+"",X=e[12].lng+"",tt=e[12].img+"";return{key:t,first:null,c(){n=c("li"),o=c("div"),r=c("div"),s=c("div"),d=u(G),g=f(),b=c("div"),$=u(V),v=f(),y=c("hr"),k=f(),w=c("div"),x=c("div"),_=u("車 "),M=u(Z),E=f(),S=c("div"),A=u("空 "),D=u(J),j=f(),C=c("details"),L=c("summary"),P=u(K),T=u(" m"),q=f(),I=c("a"),H=u(W),R=u(", "),z=u(X),N=f(),O=c("a"),Q=u(tt),Y=f(),p(y,"class","svelte-160rpoe"),p(x,"class","bike svelte-160rpoe"),p(S,"class","empty svelte-160rpoe"),p(b,"class","numbers d-f ai-c fs-0 svelte-160rpoe"),p(o,"class","d-f jc-sb ai-c svelte-160rpoe"),p(L,"class","svelte-160rpoe"),p(I,"href",B="http://maps.google.com?q="+e[12].lat+","+e[12].lng),p(I,"target","_blank"),p(I,"title","google map link"),p(O,"class","img svelte-160rpoe"),h(O,"--url","url("+e[12].img+")"),p(O,"href",U=e[12].img),p(O,"target","_blank"),p(C,"class","details svelte-160rpoe"),p(n,"class","item svelte-160rpoe"),n.value=F=e[12].sno,this.first=n},m(t,e){l(t,n,e),a(n,o),a(o,r),a(r,s),a(s,d),a(o,g),a(o,b),a(b,$),a(b,v),a(b,y),a(b,k),a(b,w),a(w,x),a(x,_),a(x,M),a(w,E),a(w,S),a(S,A),a(S,D),a(n,j),a(n,C),a(C,L),a(L,P),a(L,T),a(C,q),a(C,I),a(I,H),a(I,R),a(I,z),a(C,N),a(C,O),a(O,Q),a(n,Y)},p(t,e){2&e&&G!==(G=t[12].sna+"")&&m(d,G),2&e&&V!==(V=t[12].tot+"")&&m($,V),2&e&&Z!==(Z=t[12].sbi+"")&&m(M,Z),2&e&&J!==(J=t[12].bemp+"")&&m(D,J),2&e&&K!==(K=t[12].distance+"")&&m(P,K),2&e&&W!==(W=t[12].lat+"")&&m(H,W),2&e&&X!==(X=t[12].lng+"")&&m(z,X),2&e&&B!==(B="http://maps.google.com?q="+t[12].lat+","+t[12].lng)&&p(I,"href",B),2&e&&tt!==(tt=t[12].img+"")&&m(Q,tt),2&e&&h(O,"--url","url("+t[12].img+")"),2&e&&U!==(U=t[12].img)&&p(O,"href",U),2&e&&F!==(F=t[12].sno)&&(n.value=F)},d(t){t&&i(n)}}}function Q(t){let e,n,r,s,h,b,$,v,y,k,w,x,_,M,E,S,A,D,q,I,H,R,z=[],Q=new Map,U=t[1];const Y=t=>t[12].sno;for(let e=0;e<U.length;e+=1){let n=N(t,U,e),o=Y(n);Q.set(o,z[e]=O(o,n))}const F=new B({});return{c(){e=c("nav"),n=c("button"),n.textContent="定位",r=f(),s=c("button"),s.textContent="更新",h=f(),b=c("div"),$=c("span"),v=u("距: "),y=u(t[0]),k=u(" m"),w=f(),x=c("br"),_=f(),M=c("input"),E=f(),S=c("ol");for(let t=0;t<z.length;t+=1)z[t].c();var o;A=f(),D=c("footer"),(o=F.$$.fragment)&&o.c(),q=f(),I=c("ul"),I.innerHTML='<li>\n      GitHub: <a href="https://github.com/rplus/youbike-map">Rplus / Youbike-Map</a></li> \n    <li>\n      Relesed with: <a href="https://github.com/Rplus/youbike-map/blob/master/LICENSE">MIT license</a></li> \n    <li>\n      資料來源:\n      <br> \n      <a href="https://taipeicity.github.io/traffic_realtime/">臺北市政府 交通即時資料 開放資料專區</a></li>',p(n,"id","locate"),p(s,"id","refetch"),p(M,"type","range"),p(M,"id","range"),p(M,"max","5000"),p(M,"min","10"),p(e,"class","ctrl svelte-160rpoe"),p(S,"class","list svelte-160rpoe"),p(I,"class","info svelte-160rpoe")},m(i,c,u){l(i,e,c),a(e,n),a(e,r),a(e,s),a(e,h),a(e,b),a(b,$),a($,v),a($,y),a($,k),a(b,w),a(b,x),a(b,_),a(b,M),g(M,t[0]),l(i,E,c),l(i,S,c);for(let t=0;t<z.length;t+=1)z[t].m(S,null);l(i,A,c),l(i,D,c),P(F,D,null),a(D,q),a(D,I),H=!0,u&&o(R),R=[d(n,"click",t[2]),d(s,"click",t[3]),d(M,"change",t[11]),d(M,"input",t[11])]},p(t,[e]){if((!H||1&e)&&m(y,t[0]),1&e&&g(M,t[0]),2&e){const n=t[1];z=function(t,e,n,o,r,s,a,l,i,c,u,f){let d=t.length,p=s.length,m=d;const g={};for(;m--;)g[t[m].key]=m;const h=[],b=new Map,$=new Map;for(m=p;m--;){const t=f(r,s,m),l=n(t);let i=a.get(l);i?o&&i.p(t,e):(i=c(l,t),i.c()),b.set(l,h[m]=i),l in g&&$.set(l,Math.abs(m-g[l]))}const v=new Set,y=new Set;function k(t){C(t,1),t.m(l,u,a.has(t.key)),a.set(t.key,t),u=t.first,p--}for(;d&&p;){const e=h[p-1],n=t[d-1],o=e.key,r=n.key;e===n?(u=e.first,d--,p--):b.has(r)?!a.has(o)||v.has(o)?k(e):y.has(r)?d--:$.get(o)>$.get(r)?(y.add(o),k(e)):(v.add(r),d--):(i(n,a),d--)}for(;d--;){const e=t[d];b.has(e.key)||i(e,a)}for(;p;)k(h[p-1]);return h}(z,e,Y,1,t,n,Q,S,L,O,null,N)}},i(t){H||(C(F.$$.fragment,t),H=!0)},o(t){!function(t,e,n,o){if(t&&t.o){if(j.has(t))return;j.add(t),(void 0).c.push(()=>{j.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}(F.$$.fragment,t),H=!1},d(t){t&&i(e),t&&i(E),t&&i(S);for(let t=0;t<z.length;t+=1)z[t].d();t&&i(A),t&&i(D),T(F),o(R)}}}function U(t,e,n){let o=1e3,r=null,s=[];const a={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};function l(){return new Promise((t,e)=>{navigator.geolocation.getCurrentPosition(t,e,a)})}async function i(){let t=await l();n(4,r={lat:t.coords.latitude,lng:t.coords.longitude,acc:t.coords.accuracy}),console.log("setLocate",r)}async function c(){i(),console.log("fetchData");const t=await fetch("https://tcgbusfs.blob.core.windows.net/blobyoubike/YouBikeTP.json").then(t=>t.json());console.log("fetchData done",t),n(5,s=Object.values(t.retVal))}function u(t,e,n){return console.log("getRecentPoints"),t=t.map(t=>(t.img=f(t),t)),n&&(t=t.filter(t=>{const o=function(t){let[e,n,o,r]=t;if(!(e&&n&&o&&r))return null;[e,n,o,r]=t.map(t=>t*Math.PI/180);const s=Math.sin(n)*Math.sin(r)+Math.cos(e-o)*Math.cos(n)*Math.cos(r);return 6371e3*Math.acos(s)}([n.lng,n.lat,t.lng,t.lat]);return t.distance=o.toFixed(),o<e})),t.sort((t,e)=>t.distance-e.distance)}function f(t,e=300){let n,o=t;return r&&(o=r,n=t),`https://maps.googleapis.com/maps/api/staticmap?size=${e}x${e}&center=${o.lat},${o.lng}&markers=size:mid|${o.lat},${o.lng}`+(n?`&markers=color:yellow|label:T|${n.lat},${n.lng}`:"")+"&key=AIzaSyCjDnDGv67nvhzBsLRYAwTbiF1HrZBQDUM"}let d,p;return c(),t.$$.update=()=>{49&t.$$.dirty&&n(1,d=u(s,o,r)),16&t.$$.dirty&&(p=r?`&markers=${r.lat},${r.lng}`:void 0)},[o,d,i,c,r,s,p,a,l,u,f,function(){var t;t=this.value,o=""===t?void 0:+t,n(0,o)}]}return new class extends H{constructor(t){super(),I(this,t,U,Q,s,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
