var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function s(t){return"function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t,e){t.appendChild(e)}function c(t,e,n){t.insertBefore(e,n||null)}function r(t){t.parentNode.removeChild(t)}function i(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function f(){return u(" ")}function d(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function h(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function m(t,e){e=""+e,t.data!==e&&(t.data=e)}function p(t,e){(null!=e||t.value)&&(t.value=e)}function g(t,e,n,o){t.style.setProperty(e,n,o?"important":"")}let b;function y(t){b=t}const v=[],$=[],k=[],w=[],z=Promise.resolve();let _=!1;function M(t){k.push(t)}let x=!1;const D=new Set;function S(){if(!x){x=!0;do{for(let t=0;t<v.length;t+=1){const e=v[t];y(e),E(e.$$)}for(v.length=0;$.length;)$.pop()();for(let t=0;t<k.length;t+=1){const e=k[t];D.has(e)||(D.add(e),e())}k.length=0}while(v.length);for(;w.length;)w.pop()();_=!1,x=!1,D.clear()}}function E(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(M)}}const T=new Set;function A(t,e){t&&t.i&&(T.delete(t),t.i(e))}function j(t,e){t.d(1),e.delete(t.key)}function I(t,e,n,o,s,a,l,c,r,i,u,f){let d=t.length,h=a.length,m=d;const p={};for(;m--;)p[t[m].key]=m;const g=[],b=new Map,y=new Map;for(m=h;m--;){const t=f(s,a,m),c=n(t);let r=l.get(c);r?o&&r.p(t,e):(r=i(c,t),r.c()),b.set(c,g[m]=r),c in p&&y.set(c,Math.abs(m-p[c]))}const v=new Set,$=new Set;function k(t){A(t,1),t.m(c,u,l.has(t.key)),l.set(t.key,t),u=t.first,h--}for(;d&&h;){const e=g[h-1],n=t[d-1],o=e.key,s=n.key;e===n?(u=e.first,d--,h--):b.has(s)?!l.has(o)||v.has(o)?k(e):$.has(s)?d--:y.get(o)>y.get(s)?($.add(o),k(e)):(v.add(s),d--):(r(n,l),d--)}for(;d--;){const e=t[d];b.has(e.key)||r(e,l)}for(;h;)k(g[h-1]);return g}function L(t,n,a){const{fragment:l,on_mount:c,on_destroy:r,after_update:i}=t.$$;l&&l.m(n,a),M(()=>{const n=c.map(e).filter(s);r?r.push(...n):o(n),t.$$.on_mount=[]}),i.forEach(M)}function P(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function C(t,e){-1===t.$$.dirty[0]&&(v.push(t),_||(_=!0,z.then(S)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function q(e,s,a,l,c,i,u=[-1]){const f=b;y(e);const d=s.props||{},h=e.$$={fragment:null,ctx:null,props:i,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(f?f.$$.context:[]),callbacks:n(),dirty:u};let m=!1;if(h.ctx=a?a(e,d,(t,n,...o)=>{const s=o.length?o[0]:n;return h.ctx&&c(h.ctx[t],h.ctx[t]=s)&&(h.bound[t]&&h.bound[t](s),m&&C(e,t)),n}):[],h.update(),m=!0,o(h.before_update),h.fragment=!!l&&l(h.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);h.fragment&&h.fragment.l(t),t.forEach(r)}else h.fragment&&h.fragment.c();s.intro&&A(e.$$.fragment),L(e,s.target,s.anchor),S()}y(f)}class H{$destroy(){P(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function B(e){let n,o;return{c(){n=i("details"),n.innerHTML='<summary>開啟留言</summary> \n  <div><div id="disqus_thread"></div></div>',h(n,"class","svelte-wm0xa8")},m(t,s,a){c(t,n,s),a&&o(),o=d(n,"toggle",e[0])},p:t,i:t,o:t,d(t){t&&r(n),o()}}}function R(t){let e;return[function(t){var n,o;console.log(1111111111,t),e=t.target.open,e&&(console.log("initDisqus"),window.DISQUS?window.DISQUS.reset({reload:!0}):(n=document,(o=n.createElement("script")).src="https://rplus-youbike-map.disqus.com/embed.js",o.setAttribute("data-timestamp",+new Date),(n.head||n.body).appendChild(o)))}]}class N extends H{constructor(t){super(),q(this,t,R,B,a,{})}}function Y(t,e,n){const o=t.slice();return o[14]=e[n],o}function F(t,e,n){const o=t.slice();return o[14]=e[n],o}function O(t){let e,n=[],o=new Map,s=t[2].slice(0,5);const a=t=>t[14].sno;for(let e=0;e<s.length;e+=1){let l=F(t,s,e),c=a(l);o.set(c,n[e]=Q(c,l))}return{c(){e=i("div");for(let t=0;t<n.length;t+=1)n[t].c();h(e,"class","map svelte-bzcyfh")},m(t,o){c(t,e,o);for(let t=0;t<n.length;t+=1)n[t].m(e,null)},p(t,s){if(4&s){const l=t[2].slice(0,5);n=I(n,s,a,1,t,l,o,e,j,Q,null,F)}},d(t){t&&r(e);for(let t=0;t<n.length;t+=1)n[t].d()}}}function Q(t,e){let n,o;return{key:t,first:null,c(){n=i("div"),h(n,"class","map-point svelte-bzcyfh"),h(n,"data-bike",o=e[14].sbi),g(n,"--d",e[14]._d),g(n,"--a",e[14]._a),this.first=n},m(t,e){c(t,n,e)},p(t,e){4&e&&o!==(o=t[14].sbi)&&h(n,"data-bike",o),4&e&&g(n,"--d",t[14]._d),4&e&&g(n,"--a",t[14]._a)},d(t){t&&r(n)}}}function U(t,e){let n,o,s,a,d,p,b,y,v,$,k,w,z,_,M,x,D,S,E,T,A,j,I,L,P,C,q,H,B,R,N,Y,F,O,Q,U,G,V=e[14].sna+"",W=e[14].tot+"",Z=e[14].sbi+"",J=e[14].bemp+"",K=e[14].distance+"",X=e[14].lat+"",tt=e[14].lng+"";return{key:t,first:null,c(){n=i("li"),o=i("div"),s=i("div"),a=i("div"),d=u(V),p=f(),b=i("div"),y=i("span"),v=u(W),$=f(),k=i("hr"),w=f(),z=i("div"),_=i("div"),M=u("車 "),x=u(Z),D=f(),S=i("div"),E=u("空 "),T=u(J),A=f(),j=i("details"),I=i("summary"),L=u(K),P=u(" m"),C=f(),q=i("a"),H=u(X),B=u(", "),R=u(tt),Y=f(),F=i("a"),O=u("_"),U=f(),h(y,"class","sum svelte-bzcyfh"),h(k,"class","svelte-bzcyfh"),h(_,"class","bike svelte-bzcyfh"),h(S,"class","empty svelte-bzcyfh"),h(b,"class","numbers d-f ai-c fs-0 svelte-bzcyfh"),h(o,"class","d-f jc-sb ai-c svelte-bzcyfh"),h(I,"class","summary svelte-bzcyfh"),h(q,"href",N="http://maps.google.com?q="+e[14].lat+","+e[14].lng),h(q,"target","_blank"),h(q,"title","google map link"),h(F,"class","img svelte-bzcyfh"),g(F,"--url","url("+e[14].img+")"),h(F,"href",Q=e[14].img),h(F,"target","_blank"),h(j,"class","details svelte-bzcyfh"),h(n,"class","item svelte-bzcyfh"),n.value=G=e[14].sno,this.first=n},m(t,e){c(t,n,e),l(n,o),l(o,s),l(s,a),l(a,d),l(o,p),l(o,b),l(b,y),l(y,v),l(b,$),l(b,k),l(b,w),l(b,z),l(z,_),l(_,M),l(_,x),l(z,D),l(z,S),l(S,E),l(S,T),l(n,A),l(n,j),l(j,I),l(I,L),l(I,P),l(j,C),l(j,q),l(q,H),l(q,B),l(q,R),l(j,Y),l(j,F),l(F,O),l(n,U)},p(t,e){4&e&&V!==(V=t[14].sna+"")&&m(d,V),4&e&&W!==(W=t[14].tot+"")&&m(v,W),4&e&&Z!==(Z=t[14].sbi+"")&&m(x,Z),4&e&&J!==(J=t[14].bemp+"")&&m(T,J),4&e&&K!==(K=t[14].distance+"")&&m(L,K),4&e&&X!==(X=t[14].lat+"")&&m(H,X),4&e&&tt!==(tt=t[14].lng+"")&&m(R,tt),4&e&&N!==(N="http://maps.google.com?q="+t[14].lat+","+t[14].lng)&&h(q,"href",N),4&e&&g(F,"--url","url("+t[14].img+")"),4&e&&Q!==(Q=t[14].img)&&h(F,"href",Q),4&e&&G!==(G=t[14].sno)&&(n.value=G)},d(t){t&&r(n)}}}function G(t){let e,n,s,a,g,b,y,v,$,k,w,z,_,M,x,D,S,E,C,q,H,B,R,F,Q,G,V,W,Z,J,K=[],X=new Map,tt=t[1]&&O(t),et=t[2];const nt=t=>t[14].sno;for(let e=0;e<et.length;e+=1){let n=Y(t,et,e),o=nt(n);X.set(o,K[e]=U(o,n))}const ot=new N({});return{c(){e=i("nav"),n=i("button"),n.textContent="定位",s=f(),a=i("button"),g=u("更新"),b=f(),y=i("div"),v=i("span"),$=u("距: "),k=u(t[0]),w=u(" m"),z=f(),_=i("br"),M=f(),x=i("input"),D=f(),S=i("div"),E=i("div"),C=u(t[3]),q=f(),tt&&tt.c(),H=f(),B=i("ol");for(let t=0;t<K.length;t+=1)K[t].c();var o;R=f(),F=i("footer"),Q=i("header"),Q.innerHTML="<h1>YouBike Map</h1>",G=f(),(o=ot.$$.fragment)&&o.c(),V=f(),W=i("ul"),W.innerHTML='<li>\n      GitHub: <a href="https://github.com/rplus/youbike-map">Rplus / Youbike-Map</a></li> \n    <li>\n      Relesed with: <a href="https://github.com/Rplus/youbike-map/blob/master/LICENSE">MIT license</a></li> \n    <li>\n      資料來源:\n      <br> \n      <a href="https://taipeicity.github.io/traffic_realtime/">臺北市政府 交通即時資料 開放資料專區</a></li>',h(n,"id","locate"),h(a,"id","refetch"),h(a,"data-updatetime",t[4]),h(a,"class","svelte-bzcyfh"),h(x,"type","range"),h(x,"id","range"),h(x,"max","5000"),h(x,"min","10"),h(x,"step","50"),h(e,"class","ctrl svelte-bzcyfh"),h(E,"class","error-message svelte-bzcyfh"),h(B,"class","list svelte-bzcyfh"),h(S,"class","workspace svelte-bzcyfh"),h(Q,"class","svelte-bzcyfh"),h(W,"class","info svelte-bzcyfh"),h(F,"class","footer d-f svelte-bzcyfh")},m(r,i,u){c(r,e,i),l(e,n),l(e,s),l(e,a),l(a,g),l(e,b),l(e,y),l(y,v),l(v,$),l(v,k),l(v,w),l(y,z),l(y,_),l(y,M),l(y,x),p(x,t[0]),c(r,D,i),c(r,S,i),l(S,E),l(E,C),l(S,q),tt&&tt.m(S,null),l(S,H),l(S,B);for(let t=0;t<K.length;t+=1)K[t].m(B,null);c(r,R,i),c(r,F,i),l(F,Q),l(F,G),L(ot,F,null),l(F,V),l(F,W),Z=!0,u&&o(J),J=[d(n,"click",t[5]),d(a,"click",t[6]),d(x,"change",t[13]),d(x,"input",t[13])]},p(t,[e]){if((!Z||16&e)&&h(a,"data-updatetime",t[4]),(!Z||1&e)&&m(k,t[0]),1&e&&p(x,t[0]),(!Z||8&e)&&m(C,t[3]),t[1]?tt?tt.p(t,e):(tt=O(t),tt.c(),tt.m(S,H)):tt&&(tt.d(1),tt=null),4&e){const n=t[2];K=I(K,e,nt,1,t,n,X,B,j,U,null,Y)}},i(t){Z||(A(ot.$$.fragment,t),Z=!0)},o(t){!function(t,e,n,o){if(t&&t.o){if(T.has(t))return;T.add(t),(void 0).c.push(()=>{T.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}(ot.$$.fragment,t),Z=!1},d(t){t&&r(e),t&&r(D),t&&r(S),tt&&tt.d();for(let t=0;t<K.length;t+=1)K[t].d();t&&r(R),t&&r(F),P(ot),o(J)}}}function V(t,e,n){let o=1e3,s=null,a=[];const l={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};function c(){return new Promise((t,e)=>{navigator.geolocation.getCurrentPosition(t,e,l)})}async function r(){let t=await c();n(1,s={lat:t.coords.latitude,lng:t.coords.longitude,acc:t.coords.accuracy}),console.log("setLocate",s)}async function i(){r(),console.log("fetchData");try{const t=await fetch("https://tcgbusfs.blob.core.windows.net/blobyoubike/YouBikeTP.json"),e=await t.json();n(7,a=Object.values(e.retVal)),console.log("fetchData done",e)}catch(t){n(3,m=t),console.error(123,t)}n(4,p=new Intl.DateTimeFormat("zh-TW",{timeStyle:"medium",hour12:!1}).format(new Date))}function u(t,e,n){return console.log("getRecentPoints"),t=t.map(t=>(t.img=f(t),t)),n&&(t=t.filter(t=>{const o=function(t){let[e,n,o,s]=t;if(!(e&&n&&o&&s))return null;[e,n,o,s]=t.map(t=>t*Math.PI/180);const a=Math.sin(n)*Math.sin(s)+Math.cos(e-o)*Math.cos(n)*Math.cos(s);return 6371e3*Math.acos(a)}([n.lng,n.lat,t.lng,t.lat]);t.distance=o.toFixed();let s=t.lng-n.lng,a=t.lat-n.lat;return t._d=t.distance/e,t._a=Math.atan2(a,s)/Math.PI*180,o<e})),t.sort((t,e)=>t.distance-e.distance)}function f(t,e=300){let n,o=t;return s&&(o=s,n=t),`https://maps.googleapis.com/maps/api/staticmap?size=${e}x${e}&center=${o.lat},${o.lng}&markers=size:mid|${o.lat},${o.lng}`+(n?`&markers=color:yellow|label:T|${n.lat},${n.lng}`:"")+"&key=AIzaSyCjDnDGv67nvhzBsLRYAwTbiF1HrZBQDUM"}let d,h,m,p;return i(),t.$$.update=()=>{131&t.$$.dirty&&n(2,d=u(a,o,s)),2&t.$$.dirty&&(h=s?`&markers=${s.lat},${s.lng}`:void 0)},n(3,m=""),n(4,p=""),[o,s,d,m,p,r,i,a,h,l,c,u,f,function(){var t;t=this.value,o=""===t?void 0:+t,n(0,o)}]}return new class extends H{constructor(t){super(),q(this,t,V,G,a,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
