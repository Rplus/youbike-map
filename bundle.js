var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function s(t){return"function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t,e){t.appendChild(e)}function r(t,e,n){t.insertBefore(e,n||null)}function i(t){t.parentNode.removeChild(t)}function c(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function d(){return u(" ")}function f(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function m(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function v(t,e){e=""+e,t.data!==e&&(t.data=e)}function p(t,e){(null!=e||t.value)&&(t.value=e)}function g(t,e,n,o){t.style.setProperty(e,n,o?"important":"")}let h;function b(t){h=t}const y=[],w=[],$=[],k=[],_=Promise.resolve();let M=!1;function x(t){$.push(t)}let D=!1;const S=new Set;function E(){if(!D){D=!0;do{for(let t=0;t<y.length;t+=1){const e=y[t];b(e),T(e.$$)}for(y.length=0;w.length;)w.pop()();for(let t=0;t<$.length;t+=1){const e=$[t];S.has(e)||(S.add(e),e())}$.length=0}while(y.length);for(;k.length;)k.pop()();M=!1,D=!1,S.clear()}}function T(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(x)}}const A=new Set;function j(t,e){t&&t.i&&(A.delete(t),t.i(e))}function I(t,e){t.d(1),e.delete(t.key)}function L(t,e,n,o,s,a,l,r,i,c,u,d){let f=t.length,m=a.length,v=f;const p={};for(;v--;)p[t[v].key]=v;const g=[],h=new Map,b=new Map;for(v=m;v--;){const t=d(s,a,v),r=n(t);let i=l.get(r);i?o&&i.p(t,e):(i=c(r,t),i.c()),h.set(r,g[v]=i),r in p&&b.set(r,Math.abs(v-p[r]))}const y=new Set,w=new Set;function $(t){j(t,1),t.m(r,u,l.has(t.key)),l.set(t.key,t),u=t.first,m--}for(;f&&m;){const e=g[m-1],n=t[f-1],o=e.key,s=n.key;e===n?(u=e.first,f--,m--):h.has(s)?!l.has(o)||y.has(o)?$(e):w.has(s)?f--:b.get(o)>b.get(s)?(w.add(o),$(e)):(y.add(s),f--):(i(n,l),f--)}for(;f--;){const e=t[f];h.has(e.key)||i(e,l)}for(;m;)$(g[m-1]);return g}function P(t,n,a){const{fragment:l,on_mount:r,on_destroy:i,after_update:c}=t.$$;l&&l.m(n,a),x(()=>{const n=r.map(e).filter(s);i?i.push(...n):o(n),t.$$.on_mount=[]}),c.forEach(x)}function C(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function q(t,e){-1===t.$$.dirty[0]&&(y.push(t),M||(M=!0,_.then(E)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function H(e,s,a,l,r,c,u=[-1]){const d=h;b(e);const f=s.props||{},m=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:r,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:n(),dirty:u};let v=!1;if(m.ctx=a?a(e,f,(t,n,...o)=>{const s=o.length?o[0]:n;return m.ctx&&r(m.ctx[t],m.ctx[t]=s)&&(m.bound[t]&&m.bound[t](s),v&&q(e,t)),n}):[],m.update(),v=!0,o(m.before_update),m.fragment=!!l&&l(m.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);m.fragment&&m.fragment.l(t),t.forEach(i)}else m.fragment&&m.fragment.c();s.intro&&j(e.$$.fragment),P(e,s.target,s.anchor),E()}b(d)}class z{$destroy(){C(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function B(e){let n,o;return{c(){n=c("details"),n.innerHTML='<summary>開啟留言</summary> \n  <div><div id="disqus_thread"></div></div>',m(n,"class","svelte-wm0xa8")},m(t,s,a){r(t,n,s),a&&o(),o=f(n,"toggle",e[0])},p:t,i:t,o:t,d(t){t&&i(n),o()}}}function R(t){let e;return[function(t){var n,o;console.log(1111111111,t),e=t.target.open,e&&(console.log("initDisqus"),window.DISQUS?window.DISQUS.reset({reload:!0}):(n=document,(o=n.createElement("script")).src="https://rplus-youbike-map.disqus.com/embed.js",o.setAttribute("data-timestamp",+new Date),(n.head||n.body).appendChild(o)))}]}class N extends z{constructor(t){super(),H(this,t,R,B,a,{})}}function Y(t,e,n){const o=t.slice();return o[14]=e[n],o}function F(t,e,n){const o=t.slice();return o[14]=e[n],o}function O(t){let e,n=[],o=new Map,s=t[2].slice(0,5);const a=t=>t[14].sno;for(let e=0;e<s.length;e+=1){let l=F(t,s,e),r=a(l);o.set(r,n[e]=Q(r,l))}return{c(){e=c("div");for(let t=0;t<n.length;t+=1)n[t].c();m(e,"class","map svelte-vmv9dw")},m(t,o){r(t,e,o);for(let t=0;t<n.length;t+=1)n[t].m(e,null)},p(t,s){if(4&s){const l=t[2].slice(0,5);n=L(n,s,a,1,t,l,o,e,I,Q,null,F)}},d(t){t&&i(e);for(let t=0;t<n.length;t+=1)n[t].d()}}}function Q(t,e){let n,o,s;return{key:t,first:null,c(){n=c("div"),m(n,"class","map-point svelte-vmv9dw"),m(n,"data-name",o=e[14].sna),m(n,"data-bike",s=e[14].sbi),g(n,"--d",e[14]._d),g(n,"--a",e[14]._a),this.first=n},m(t,e){r(t,n,e)},p(t,e){4&e&&o!==(o=t[14].sna)&&m(n,"data-name",o),4&e&&s!==(s=t[14].sbi)&&m(n,"data-bike",s),4&e&&g(n,"--d",t[14]._d),4&e&&g(n,"--a",t[14]._a)},d(t){t&&i(n)}}}function U(t,e){let n,o,s,a,f,p,h,b,y,w,$,k,_,M,x,D,S,E,T,A,j,I,L,P,C,q,H,z,B,R,N,Y,F,O,Q,U,G,V=e[14].sna+"",W=e[14].tot+"",Z=e[14].sbi+"",J=e[14].bemp+"",K=e[14].distance+"",X=e[14].lat+"",tt=e[14].lng+"";return{key:t,first:null,c(){n=c("li"),o=c("div"),s=c("div"),a=c("div"),f=u(V),p=d(),h=c("div"),b=c("span"),y=u(W),w=d(),$=c("hr"),k=d(),_=c("div"),M=c("div"),x=u("車 "),D=u(Z),S=d(),E=c("div"),T=u("空 "),A=u(J),j=d(),I=c("details"),L=c("summary"),P=u(K),C=u(" m"),q=d(),H=c("a"),z=u(X),B=u(", "),R=u(tt),Y=d(),F=c("a"),O=u("_"),U=d(),m(b,"class","sum svelte-vmv9dw"),m($,"class","svelte-vmv9dw"),m(M,"class","bike svelte-vmv9dw"),m(E,"class","empty svelte-vmv9dw"),m(h,"class","numbers d-f ai-c fs-0 svelte-vmv9dw"),m(o,"class","d-f jc-sb ai-c svelte-vmv9dw"),m(L,"class","summary svelte-vmv9dw"),m(H,"href",N="http://maps.google.com?q="+e[14].lat+","+e[14].lng),m(H,"target","_blank"),m(H,"title","google map link"),m(F,"class","img svelte-vmv9dw"),g(F,"--url","url("+e[14].img+")"),m(F,"href",Q=e[14].img),m(F,"target","_blank"),m(I,"class","details svelte-vmv9dw"),m(n,"class","item svelte-vmv9dw"),n.value=G=e[14].sno,this.first=n},m(t,e){r(t,n,e),l(n,o),l(o,s),l(s,a),l(a,f),l(o,p),l(o,h),l(h,b),l(b,y),l(h,w),l(h,$),l(h,k),l(h,_),l(_,M),l(M,x),l(M,D),l(_,S),l(_,E),l(E,T),l(E,A),l(n,j),l(n,I),l(I,L),l(L,P),l(L,C),l(I,q),l(I,H),l(H,z),l(H,B),l(H,R),l(I,Y),l(I,F),l(F,O),l(n,U)},p(t,e){4&e&&V!==(V=t[14].sna+"")&&v(f,V),4&e&&W!==(W=t[14].tot+"")&&v(y,W),4&e&&Z!==(Z=t[14].sbi+"")&&v(D,Z),4&e&&J!==(J=t[14].bemp+"")&&v(A,J),4&e&&K!==(K=t[14].distance+"")&&v(P,K),4&e&&X!==(X=t[14].lat+"")&&v(z,X),4&e&&tt!==(tt=t[14].lng+"")&&v(R,tt),4&e&&N!==(N="http://maps.google.com?q="+t[14].lat+","+t[14].lng)&&m(H,"href",N),4&e&&g(F,"--url","url("+t[14].img+")"),4&e&&Q!==(Q=t[14].img)&&m(F,"href",Q),4&e&&G!==(G=t[14].sno)&&(n.value=G)},d(t){t&&i(n)}}}function G(t){let e,n,s,a,g,h,b,y,w,$,k,_,M,x,D,S,E,T,q,H,z,B,R,F,Q,G,V,W,Z,J,K=[],X=new Map,tt=t[1]&&O(t),et=t[2];const nt=t=>t[14].sno;for(let e=0;e<et.length;e+=1){let n=Y(t,et,e),o=nt(n);X.set(o,K[e]=U(o,n))}const ot=new N({});return{c(){e=c("nav"),n=c("button"),n.textContent="定位",s=d(),a=c("button"),g=u("更新"),h=d(),b=c("div"),y=c("span"),w=u("距: "),$=u(t[0]),k=u(" m"),_=d(),M=c("br"),x=d(),D=c("input"),S=d(),E=c("div"),T=c("div"),q=u(t[3]),H=d(),tt&&tt.c(),z=d(),B=c("ol");for(let t=0;t<K.length;t+=1)K[t].c();var o;R=d(),F=c("footer"),Q=c("header"),Q.innerHTML="<h1>YouBike Map</h1>",G=d(),(o=ot.$$.fragment)&&o.c(),V=d(),W=c("ul"),W.innerHTML='<li>\n      GitHub: <a href="https://github.com/rplus/youbike-map">Rplus / Youbike-Map</a></li> \n    <li>\n      Relesed with: <a href="https://github.com/Rplus/youbike-map/blob/master/LICENSE">MIT license</a></li> \n    <li>\n      資料來源:\n      <br> \n      <a href="https://taipeicity.github.io/traffic_realtime/">臺北市政府 交通即時資料 開放資料專區</a></li>',m(n,"id","locate"),m(a,"id","refetch"),m(a,"data-updatetime",t[4]),m(a,"class","svelte-vmv9dw"),m(D,"type","range"),m(D,"id","range"),m(D,"max","5000"),m(D,"min","10"),m(D,"step","50"),m(e,"class","ctrl svelte-vmv9dw"),m(T,"class","error-message svelte-vmv9dw"),m(B,"class","list svelte-vmv9dw"),m(E,"class","workspace svelte-vmv9dw"),m(Q,"class","svelte-vmv9dw"),m(W,"class","info svelte-vmv9dw"),m(F,"class","footer d-f svelte-vmv9dw")},m(i,c,u){r(i,e,c),l(e,n),l(e,s),l(e,a),l(a,g),l(e,h),l(e,b),l(b,y),l(y,w),l(y,$),l(y,k),l(b,_),l(b,M),l(b,x),l(b,D),p(D,t[0]),r(i,S,c),r(i,E,c),l(E,T),l(T,q),l(E,H),tt&&tt.m(E,null),l(E,z),l(E,B);for(let t=0;t<K.length;t+=1)K[t].m(B,null);r(i,R,c),r(i,F,c),l(F,Q),l(F,G),P(ot,F,null),l(F,V),l(F,W),Z=!0,u&&o(J),J=[f(n,"click",t[5]),f(a,"click",t[6]),f(D,"change",t[13]),f(D,"input",t[13])]},p(t,[e]){if((!Z||16&e)&&m(a,"data-updatetime",t[4]),(!Z||1&e)&&v($,t[0]),1&e&&p(D,t[0]),(!Z||8&e)&&v(q,t[3]),t[1]?tt?tt.p(t,e):(tt=O(t),tt.c(),tt.m(E,z)):tt&&(tt.d(1),tt=null),4&e){const n=t[2];K=L(K,e,nt,1,t,n,X,B,I,U,null,Y)}},i(t){Z||(j(ot.$$.fragment,t),Z=!0)},o(t){!function(t,e,n,o){if(t&&t.o){if(A.has(t))return;A.add(t),(void 0).c.push(()=>{A.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}(ot.$$.fragment,t),Z=!1},d(t){t&&i(e),t&&i(S),t&&i(E),tt&&tt.d();for(let t=0;t<K.length;t+=1)K[t].d();t&&i(R),t&&i(F),C(ot),o(J)}}}function V(t,e,n){let o=1e3,s=null,a=[];const l={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};function r(){return new Promise((t,e)=>{navigator.geolocation.getCurrentPosition(t,e,l)})}async function i(){let t=await r();n(1,s={lat:t.coords.latitude,lng:t.coords.longitude,acc:t.coords.accuracy}),console.log("setLocate",s)}async function c(){i(),console.log("fetchData");try{const t=await fetch("https://tcgbusfs.blob.core.windows.net/blobyoubike/YouBikeTP.json"),e=await t.json();n(7,a=Object.values(e.retVal)),console.log("fetchData done",e)}catch(t){n(3,v=t),console.error(123,t)}n(4,p=new Intl.DateTimeFormat("zh-TW",{timeStyle:"medium",hour12:!1}).format(new Date))}function u(t,e,n){return console.log("getRecentPoints"),t=t.map(t=>(t.img=d(t),t)),n&&(t=t.filter(t=>{const o=function(t){let[e,n,o,s]=t;if(!(e&&n&&o&&s))return null;[e,n,o,s]=t.map(t=>t*Math.PI/180);const a=Math.sin(n)*Math.sin(s)+Math.cos(e-o)*Math.cos(n)*Math.cos(s);return 6371e3*Math.acos(a)}([n.lng,n.lat,t.lng,t.lat]);t.distance=o.toFixed();let s=t.lng-n.lng,a=t.lat-n.lat;return t._d=t.distance/e,t._a=Math.atan2(a,s)/Math.PI*180,o<e})),t.sort((t,e)=>t.distance-e.distance)}function d(t,e=300){let n,o=t;return s&&(o=s,n=t),`https://maps.googleapis.com/maps/api/staticmap?size=${e}x${e}&center=${o.lat},${o.lng}&markers=size:mid|${o.lat},${o.lng}`+(n?`&markers=color:yellow|label:T|${n.lat},${n.lng}`:"")+"&key=AIzaSyCjDnDGv67nvhzBsLRYAwTbiF1HrZBQDUM"}let f,m,v,p;return c(),t.$$.update=()=>{131&t.$$.dirty&&n(2,f=u(a,o,s)),2&t.$$.dirty&&(m=s?`&markers=${s.lat},${s.lng}`:void 0)},n(3,v=""),n(4,p=""),[o,s,f,v,p,i,c,a,m,l,r,u,d,function(){var t;t=this.value,o=""===t?void 0:+t,n(0,o)}]}return new class extends z{constructor(t){super(),H(this,t,V,G,a,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
