var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function s(t){return"function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function r(t,e){t.appendChild(e)}function l(t,e,n){t.insertBefore(e,n||null)}function i(t){t.parentNode.removeChild(t)}function c(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function d(){return u(" ")}function f(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function m(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function g(t,e){e=""+e,t.data!==e&&(t.data=e)}function h(t,e){(null!=e||t.value)&&(t.value=e)}function p(t,e,n,o){t.style.setProperty(e,n,o?"important":"")}let b;function v(t){b=t}const $=[],y=[],w=[],k=[],j=Promise.resolve();let x=!1;function M(t){w.push(t)}let _=!1;const E=new Set;function S(){if(!_){_=!0;do{for(let t=0;t<$.length;t+=1){const e=$[t];v(e),A(e.$$)}for($.length=0;y.length;)y.pop()();for(let t=0;t<w.length;t+=1){const e=w[t];E.has(e)||(E.add(e),e())}w.length=0}while($.length);for(;k.length;)k.pop()();x=!1,_=!1,E.clear()}}function A(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(M)}}const D=new Set;function C(t,e){t&&t.i&&(D.delete(t),t.i(e))}function L(t,e){t.d(1),e.delete(t.key)}function T(t,n,a){const{fragment:r,on_mount:l,on_destroy:i,after_update:c}=t.$$;r&&r.m(n,a),M(()=>{const n=l.map(e).filter(s);i?i.push(...n):o(n),t.$$.on_mount=[]}),c.forEach(M)}function P(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function q(t,e){-1===t.$$.dirty[0]&&($.push(t),x||(x=!0,j.then(S)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function H(e,s,a,r,l,c,u=[-1]){const d=b;v(e);const f=s.props||{},m=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:l,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:n(),dirty:u};let g=!1;if(m.ctx=a?a(e,f,(t,n,...o)=>{const s=o.length?o[0]:n;return m.ctx&&l(m.ctx[t],m.ctx[t]=s)&&(m.bound[t]&&m.bound[t](s),g&&q(e,t)),n}):[],m.update(),g=!0,o(m.before_update),m.fragment=!!r&&r(m.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);m.fragment&&m.fragment.l(t),t.forEach(i)}else m.fragment&&m.fragment.c();s.intro&&C(e.$$.fragment),T(e,s.target,s.anchor),S()}v(d)}class I{$destroy(){P(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function B(e){let n,o;return{c(){n=c("details"),n.innerHTML='<summary>開啟留言</summary> \n  <div><div id="disqus_thread"></div></div>',m(n,"class","svelte-wm0xa8")},m(t,s,a){l(t,n,s),a&&o(),o=f(n,"toggle",e[0])},p:t,i:t,o:t,d(t){t&&i(n),o()}}}function R(t){let e;return[function(t){var n,o;console.log(1111111111,t),e=t.target.open,e&&(console.log("initDisqus"),window.DISQUS?window.DISQUS.reset({reload:!0}):(n=document,(o=n.createElement("script")).src="https://rplus-youbike-map.disqus.com/embed.js",o.setAttribute("data-timestamp",+new Date),(n.head||n.body).appendChild(o)))}]}class z extends I{constructor(t){super(),H(this,t,R,B,a,{})}}function N(t,e,n){const o=t.slice();return o[12]=e[n],o}function Y(t,e){let n,o,s,a,f,h,b,v,$,y,w,k,j,x,M,_,E,S,A,D,C,L,T,P,q,H,I,B,R,z,N,Y,O,Q,U,F,G,V=e[12].sna+"",Z=e[12].tot+"",J=e[12].sbi+"",K=e[12].bemp+"",W=e[12].distance+"",X=e[12].lat+"",tt=e[12].lng+"";return{key:t,first:null,c(){n=c("li"),o=c("div"),s=c("div"),a=c("div"),f=u(V),h=d(),b=c("div"),v=c("span"),$=u(Z),y=d(),w=c("hr"),k=d(),j=c("div"),x=c("div"),M=u("車 "),_=u(J),E=d(),S=c("div"),A=u("空 "),D=u(K),C=d(),L=c("details"),T=c("summary"),P=u(W),q=u(" m"),H=d(),I=c("a"),B=u(X),R=u(", "),z=u(tt),Y=d(),O=c("a"),Q=u("_"),F=d(),m(v,"class","sum svelte-1dwj2tb"),m(w,"class","svelte-1dwj2tb"),m(x,"class","bike svelte-1dwj2tb"),m(S,"class","empty svelte-1dwj2tb"),m(b,"class","numbers d-f ai-c fs-0 svelte-1dwj2tb"),m(o,"class","d-f jc-sb ai-c svelte-1dwj2tb"),m(T,"class","summary svelte-1dwj2tb"),m(I,"href",N="http://maps.google.com?q="+e[12].lat+","+e[12].lng),m(I,"target","_blank"),m(I,"title","google map link"),m(O,"class","img svelte-1dwj2tb"),p(O,"--url","url("+e[12].img+")"),m(O,"href",U=e[12].img),m(O,"target","_blank"),m(L,"class","details svelte-1dwj2tb"),m(n,"class","item svelte-1dwj2tb"),n.value=G=e[12].sno,this.first=n},m(t,e){l(t,n,e),r(n,o),r(o,s),r(s,a),r(a,f),r(o,h),r(o,b),r(b,v),r(v,$),r(b,y),r(b,w),r(b,k),r(b,j),r(j,x),r(x,M),r(x,_),r(j,E),r(j,S),r(S,A),r(S,D),r(n,C),r(n,L),r(L,T),r(T,P),r(T,q),r(L,H),r(L,I),r(I,B),r(I,R),r(I,z),r(L,Y),r(L,O),r(O,Q),r(n,F)},p(t,e){2&e&&V!==(V=t[12].sna+"")&&g(f,V),2&e&&Z!==(Z=t[12].tot+"")&&g($,Z),2&e&&J!==(J=t[12].sbi+"")&&g(_,J),2&e&&K!==(K=t[12].bemp+"")&&g(D,K),2&e&&W!==(W=t[12].distance+"")&&g(P,W),2&e&&X!==(X=t[12].lat+"")&&g(B,X),2&e&&tt!==(tt=t[12].lng+"")&&g(z,tt),2&e&&N!==(N="http://maps.google.com?q="+t[12].lat+","+t[12].lng)&&m(I,"href",N),2&e&&p(O,"--url","url("+t[12].img+")"),2&e&&U!==(U=t[12].img)&&m(O,"href",U),2&e&&G!==(G=t[12].sno)&&(n.value=G)},d(t){t&&i(n)}}}function O(t){let e,n,s,a,p,b,v,$,y,w,k,j,x,M,_,E,S,A,q,H,I,B,R,O,Q=[],U=new Map,F=t[1];const G=t=>t[12].sno;for(let e=0;e<F.length;e+=1){let n=N(t,F,e),o=G(n);U.set(o,Q[e]=Y(o,n))}const V=new z({});return{c(){e=c("nav"),n=c("button"),n.textContent="定位",s=d(),a=c("button"),a.textContent="更新",p=d(),b=c("div"),v=c("span"),$=u("距: "),y=u(t[0]),w=u(" m"),k=d(),j=c("br"),x=d(),M=c("input"),_=d(),E=c("ol");for(let t=0;t<Q.length;t+=1)Q[t].c();var o;S=d(),A=c("footer"),q=c("header"),q.innerHTML="<h1>YouBike Map</h1>",H=d(),(o=V.$$.fragment)&&o.c(),I=d(),B=c("ul"),B.innerHTML='<li>\n      GitHub: <a href="https://github.com/rplus/youbike-map">Rplus / Youbike-Map</a></li> \n    <li>\n      Relesed with: <a href="https://github.com/Rplus/youbike-map/blob/master/LICENSE">MIT license</a></li> \n    <li>\n      資料來源:\n      <br> \n      <a href="https://taipeicity.github.io/traffic_realtime/">臺北市政府 交通即時資料 開放資料專區</a></li>',m(n,"id","locate"),m(a,"id","refetch"),m(M,"type","range"),m(M,"id","range"),m(M,"max","5000"),m(M,"min","10"),m(M,"step","50"),m(e,"class","ctrl svelte-1dwj2tb"),m(E,"class","list svelte-1dwj2tb"),m(q,"class","svelte-1dwj2tb"),m(B,"class","info svelte-1dwj2tb"),m(A,"class","footer d-f svelte-1dwj2tb")},m(i,c,u){l(i,e,c),r(e,n),r(e,s),r(e,a),r(e,p),r(e,b),r(b,v),r(v,$),r(v,y),r(v,w),r(b,k),r(b,j),r(b,x),r(b,M),h(M,t[0]),l(i,_,c),l(i,E,c);for(let t=0;t<Q.length;t+=1)Q[t].m(E,null);l(i,S,c),l(i,A,c),r(A,q),r(A,H),T(V,A,null),r(A,I),r(A,B),R=!0,u&&o(O),O=[f(n,"click",t[2]),f(a,"click",t[3]),f(M,"change",t[11]),f(M,"input",t[11])]},p(t,[e]){if((!R||1&e)&&g(y,t[0]),1&e&&h(M,t[0]),2&e){const n=t[1];Q=function(t,e,n,o,s,a,r,l,i,c,u,d){let f=t.length,m=a.length,g=f;const h={};for(;g--;)h[t[g].key]=g;const p=[],b=new Map,v=new Map;for(g=m;g--;){const t=d(s,a,g),l=n(t);let i=r.get(l);i?o&&i.p(t,e):(i=c(l,t),i.c()),b.set(l,p[g]=i),l in h&&v.set(l,Math.abs(g-h[l]))}const $=new Set,y=new Set;function w(t){C(t,1),t.m(l,u,r.has(t.key)),r.set(t.key,t),u=t.first,m--}for(;f&&m;){const e=p[m-1],n=t[f-1],o=e.key,s=n.key;e===n?(u=e.first,f--,m--):b.has(s)?!r.has(o)||$.has(o)?w(e):y.has(s)?f--:v.get(o)>v.get(s)?(y.add(o),w(e)):($.add(s),f--):(i(n,r),f--)}for(;f--;){const e=t[f];b.has(e.key)||i(e,r)}for(;m;)w(p[m-1]);return p}(Q,e,G,1,t,n,U,E,L,Y,null,N)}},i(t){R||(C(V.$$.fragment,t),R=!0)},o(t){!function(t,e,n,o){if(t&&t.o){if(D.has(t))return;D.add(t),(void 0).c.push(()=>{D.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}(V.$$.fragment,t),R=!1},d(t){t&&i(e),t&&i(_),t&&i(E);for(let t=0;t<Q.length;t+=1)Q[t].d();t&&i(S),t&&i(A),P(V),o(O)}}}function Q(t,e,n){let o=1e3,s=null,a=[];const r={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};function l(){return new Promise((t,e)=>{navigator.geolocation.getCurrentPosition(t,e,r)})}async function i(){let t=await l();n(4,s={lat:t.coords.latitude,lng:t.coords.longitude,acc:t.coords.accuracy}),console.log("setLocate",s)}async function c(){i(),console.log("fetchData");const t=await fetch("https://tcgbusfs.blob.core.windows.net/blobyoubike/YouBikeTP.json").then(t=>t.json());console.log("fetchData done",t),n(5,a=Object.values(t.retVal))}function u(t,e,n){return console.log("getRecentPoints"),t=t.map(t=>(t.img=d(t),t)),n&&(t=t.filter(t=>{const o=function(t){let[e,n,o,s]=t;if(!(e&&n&&o&&s))return null;[e,n,o,s]=t.map(t=>t*Math.PI/180);const a=Math.sin(n)*Math.sin(s)+Math.cos(e-o)*Math.cos(n)*Math.cos(s);return 6371e3*Math.acos(a)}([n.lng,n.lat,t.lng,t.lat]);return t.distance=o.toFixed(),o<e})),t.sort((t,e)=>t.distance-e.distance)}function d(t,e=300){let n,o=t;return s&&(o=s,n=t),`https://maps.googleapis.com/maps/api/staticmap?size=${e}x${e}&center=${o.lat},${o.lng}&markers=size:mid|${o.lat},${o.lng}`+(n?`&markers=color:yellow|label:T|${n.lat},${n.lng}`:"")+"&key=AIzaSyCjDnDGv67nvhzBsLRYAwTbiF1HrZBQDUM"}let f,m;return c(),t.$$.update=()=>{49&t.$$.dirty&&n(1,f=u(a,o,s)),16&t.$$.dirty&&(m=s?`&markers=${s.lat},${s.lng}`:void 0)},[o,f,i,c,s,a,m,r,l,u,d,function(){var t;t=this.value,o=""===t?void 0:+t,n(0,o)}]}return new class extends I{constructor(t){super(),H(this,t,Q,O,a,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
